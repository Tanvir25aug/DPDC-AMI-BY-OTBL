# Nginx Configuration for DPDC AMI - 5 Minute Timeout
# This file contains the nginx configuration to fix 504 Gateway Timeout errors
#
# INSTRUCTIONS:
# 1. Copy this configuration to your nginx site config
# 2. Restart nginx: sudo systemctl restart nginx
# 3. Test the configuration: sudo nginx -t

# Add these settings inside your server block or location block

location /api/ {
    proxy_pass http://localhost:3000;

    # Connection timeouts - 5 minutes (300 seconds)
    proxy_connect_timeout 300s;
    proxy_send_timeout 300s;
    proxy_read_timeout 300s;

    # Buffer settings for large responses
    proxy_buffering on;
    proxy_buffer_size 128k;
    proxy_buffers 8 128k;
    proxy_busy_buffers_size 256k;

    # Headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # Keep alive
    proxy_http_version 1.1;
    proxy_set_header Connection "";
}

# Also add this at the http level (outside server block) if not already present
# client_max_body_size 100M;
# keepalive_timeout 300s;
